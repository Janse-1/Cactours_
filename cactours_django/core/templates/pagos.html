{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .container {
        width: 100%;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .payment-container {
        background-color: #156275;
        color: #fff;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #fff;
    }

    .payment-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
    }

    .form-group label {
        width: 150px;
        font-weight: bold;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        max-width: 250px;
    }

    .form-group input[type="checkbox"] {
        width: auto;
    }

    .options-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .cta-button {
        padding: 12px 25px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
        width: 100%;
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
    }

    .cta-button:hover {
        background-color: #45a049;
    }

    .price-total p {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
    }

    /* Para el espacio debajo del nav y general */
    body {
        padding-top: 80px; /* Ajuste para no tapar el contenido con el navbar */
    }
</style>

<div class="payment-container">
    <h2>Formulario de Pago</h2>

    <form method="POST" action="/pagos/" class="payment-form" id="payment-form">
        {% csrf_token %}

        <!-- Datos Personales -->
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="apellido">Apellido:</label>
            <input type="text" id="apellido" name="apellido" required>
        </div>

        <div class="form-group">
            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" name="email" required>

            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" required>
        </div>

        <!-- Tour Seleccionado -->
        <div class="form-group">
            <label for="tour">Tour Seleccionado:</label>
            <select id="tour" name="tour" required>
                <option value="{{ tour.id }}" selected>{{ tour.nombre }}</option>
            </select>
        </div>

        <!-- Precio Base del Tour -->
        <div class="form-group price-total">
            <label for="precio_total">Precio del Tour:</label>
            <p id="precio_total">${{ tour.precio|floatformat:2 }}</p>
        </div>

        <!-- Opciones adicionales -->
        <div class="form-group options-group">
            <label>Opciones Adicionales:</label>
            {% for opcion in opciones %}
                <div>
                    <input type="checkbox" id="{{ opcion.nombre }}" name="opciones" value="{{ opcion.id }}" data-precio="{{ opcion.precio }}" onchange="actualizarPrecio()">
                    <label for="{{ opcion.nombre }}">{{ opcion.nombre }} (+${{ opcion.precio|floatformat:2 }})</label>
                </div>
            {% endfor %}
        </div>

        <!-- Número de Personas -->
        <div class="form-group">
            <label for="num_personas">Número de Personas:</label>
            <input type="number" id="num_personas" name="num_personas" min="1" required value="1" onchange="actualizarPrecio()">
        </div>

        <!-- Precio Total Calculado -->
        <div class="form-group price-total">
            <label for="precio_total_final">Precio Total:</label>
            <p id="precio_total_final">${{ tour.precio|floatformat:2 }}</p>
        </div>

        <button type="submit" class="cta-button">Confirmar Pago</button>

    </form>

    <script>
        function actualizarPrecio() {
            let precioTotal = parseFloat("{{ tour.precio }}");
            const numPersonas = document.getElementById('num_personas').value;
            
            // Sumar el precio de las opciones adicionales seleccionadas
            const opcionesSeleccionadas = document.querySelectorAll('input[name="opciones"]:checked');
            opcionesSeleccionadas.forEach(opcion => {
                precioTotal += parseFloat(opcion.getAttribute('data-precio'));
            });

            // Multiplicar por el número de personas
            precioTotal *= numPersonas;

            // Actualizar el precio total mostrado
            document.getElementById('precio_total_final').textContent = '$' + precioTotal.toFixed(2);
        }

        window.onload = function() {
            actualizarPrecio();  // Actualizar el precio al cargar la página
        };
    </script>
</div>

{% endblock %}
